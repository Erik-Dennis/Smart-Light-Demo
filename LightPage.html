<!DOCTYPE html>


<html>
    <head>
        <title>Light Test Page</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <main>
        
    </main>

    <body>
        <button type="button" id="OffButton">Off</button>
        <button type="button" id="OnButton">On</button>
        <h3 id="Status">LED Status: Default</h3>
    </body>

    <script>
        const OnButton = document.getElementById('OnButton');
        const OffButton = document.getElementById('OffButton');
        const Status = document.getElementById('Status');
        const url = 'http://192.168.0.136:8080/';
        

        OnButton.addEventListener('click', async _ => {
            try {
                    let response = await fetch(url + 'LEDstatus/SetOn', {
                    method: 'POST',

                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'                             
                    }
                                                  
                });
                console.log(response.status);
                if(response.status == '202') {

                    Status.textContent='LED Status: On';

                }

                socket.send("on");
            }
            catch(err) {
                console.error('Error: ${err}');
            }


        });
        

        OffButton.addEventListener('click', async _ => {
            try {
                    let response = await fetch(url + 'LEDstatus/SetOff', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'                             
                    }
                });
                console.log(response.status);

                if(response.status == '205') {

                    Status.textContent='LED Status: Off';

                }

                socket.send("off");
            }
            catch(err) {
                console.error('Error: ${err}');
            }
        });
        
        
        //Websocket replaced get status and .8 sec get request
        
        const socket = new WebSocket('ws://192.168.0.136:8081');

        socket.onmessage = ({ data }) => {
            console.log('Server: ', data);

            if(data == "on"){
                Status.textContent="LED Status: On";
            }
            else if(data == "off"){
                Status.textContent="LED Status: Off";
            }
        };
        
    </script>
</html>